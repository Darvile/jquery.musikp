!function(t,i,s,a){"use strict";function n(){this.$elem.find("[data-musikp]").on("click",function(i){i.preventDefault(),this.play(t(i.target).data("musikp"))}.bind(this))}function e(){t("."+this.settings.classPrefix+"-gui").find('[data-action="play"]').on("click",function(t){t.preventDefault(),this.play("current")}.bind(this)),t("."+this.settings.classPrefix+"-gui").find('[data-action="next"]').on("click",function(t){t.preventDefault(),this.next()}.bind(this)),t("."+this.settings.classPrefix+"-gui").find('[data-action="prev"]').on("click",function(t){t.preventDefault(),this.prev()}.bind(this)),t("."+this.settings.classPrefix+"-gui").find('[data-action="expand"]').on("click",function(t){t.preventDefault(),this.toggleExpandedGUI()}.bind(this)),this.audio.addEventListener("loadeddata",function(){t("."+this.settings.classPrefix+"-gui").find('[data-live="duration"]').html(d.apply(this,[this.audio.duration]))}.bind(this)),this.audio.addEventListener("timeupdate",function(){t("."+this.settings.classPrefix+"-gui").find('[data-live="timer"]').html(d.apply(this,[this.audio.currentTime]))}.bind(this))}function r(){var t=function(t,i){return t==i?0:i>t?-1:1},i=function(i,s){var a=t;return i&&(a=function(s,a){return t(i(s),i(a))}),s?function(t,i){return-1*a(t,i)}:a},s=function(){for(var s,a,n,e=[],r=arguments.length,u=0;r>u;u++)s=arguments[u],"string"==typeof s?(a=s,n=t):(a=s.name,n=i(s.primer,s.reverse)),e.push({name:a,cmp:n});return function(t,i){for(var a,n,u,l=0,c=r;c>l&&(u=0,s=e[l],a=s.name,n=s.cmp,u=n(t[a],i[a]),0===u);l++);return u}};this.tracks=this.tracks.sort(s("album_id",{name:"track_number",primer:parseInt,reverse:!1}))}function u(){this.albums="undefined"!=typeof this.settings.playlist.albums?this.settings.playlist.albums:[],this.tracks="undefined"!=typeof this.settings.playlist.tracks?this.settings.playlist.tracks:[],r.apply(this),this.currentSoundtrack=this.tracks[0].id,this.debug("Playlist: "+this.albums.length+" albums, "+this.tracks.length+" soundtracks")}function l(){function i(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function s(t,s,a){return t.replace(new RegExp(i(s),"g"),a)}var a='<div class="$class-player"><div class="$class-wrapper"><div class="$class-button">$prev</div><div class="$class-button $class-button-xl">$play</div><div class="$class-button">$next</div><div class="$class-timer"><span data-live="artist">Unknown</span> - <span data-live="title">Unknown</span> &nbsp; | &nbsp; <span data-live="timer">00:00</span> / <span data-live="duration">00:00</span></div><div class="$class-button $class-button-xs">$expand</div></div></div>',n=a;null!=this.settings.tpl&&this.settings.tpl.length>3&&(n=this.settings.tpl),n+='<div class="$class-tracklist">',n+="Other tracks:",n+="<ul>";for(var r=0;r<this.tracks.length;++r)if("undefined"==typeof this.tracks[r].album_id){var u=this.getTrackInfo(this.tracks[r].id);n+="<li>"+u.track_number+'. <a data-musikp="'+u.id+'" href="#">'+u.title+"</a></li>"}n+="</ul>";for(var r=0;r<this.albums.length;++r){var l=this.getAlbumInfo(this.albums[r].id);n+='<a data-musikp="'+l.id+'" href="#">'+l.artist+" - "+l.title+"</a>",n+='<a data-musikp="'+l.id+'" href="#"><div class="$class-cover" style="background-image:url(\''+l.cover+"');\"></div>"+l.artist+" - "+l.title+"</a>",n+="<ul>";for(var c=0;c<l.tracks.length;++c){var u=this.getTrackInfo(l.tracks[c]);n+="<li>"+u.track_number+'. <a data-musikp="'+u.id+'" href="#">'+u.title+"</a></li>"}n+="</ul>"}n+="</div>",n=s(n,"$class",this.settings.classPrefix),n=s(n,"$prev",'<span data-action="prev">'+this.settings.prevBt+"</span>"),n=s(n,"$next",'<span data-action="next">'+this.settings.nextBt+"</span>"),n=s(n,"$play",'<span data-action="play">'+this.settings.playBt+"</span>"),n=s(n,"$expand",'<span data-action="expand">'+this.settings.expandBt+"</span>"),t("body").append('<div class="'+this.settings.classPrefix+'-gui">'+n+"</div>"),setTimeout(function(){t("body").find("."+this.settings.classPrefix+"-gui").addClass(""+this.settings.classPrefix+"-loaded")}.bind(this),1e3),this.debug("GUI opened"),this.isGUIVisible=!0,e.apply(this)}function c(){this.audio=s.createElement("audio")}function d(t){var i=Math.floor(t),s=Math.floor(i/60);return s=s>=10?s:"0"+s,i=Math.floor(i%60),i=i>=10?i:"0"+i,s+":"+i}function h(i){t("."+this.settings.classPrefix+"-gui").find("[data-live]").each(function(s,a){var n=t(a),e=n.data("live");"duration"!=e&&"timer"!=e&&n.html(i[e])}.bind(this))}function o(i,s){this.element=i,this.$elem=t(this.element),this.settings=t.extend({},f,s),this._defaults=f,this._name=p,this.init()}var p="musikp",f={mode:"auto",classPrefix:"musikp",tpl:null,playBt:">",pauseBt:"||",stopBt:"X",nextBt:">>",prevBt:"<<",expandBt:"^",debug:!1,autoPlay:!1};t.extend(o.prototype,{init:function(){this.isGUIVisible=!1,u.apply(this),c.apply(this),"gui"===this.settings.mode&&l.apply(this),n.apply(this),this.settings.autoPlay===!0&&this.play()},debug:function(t){this.settings.debug===!0&&console.log("--- "+t+" ---")},isTrack:function(i){var s=t.grep(this.tracks,function(t){return t.id==i});return s.length>0?s[0]:!1},isAlbum:function(i){var s=t.grep(this.albums,function(t){return t.id==i});return s.length>0?s[0]:!1},getCurrentSoundtrackId:function(){return this.currentSoundtrack},toggleExpandedGUI:function(){t("."+this.settings.classPrefix+"-gui").toggleClass("expanded")},getAlbumInfo:function(i){var s=this.isAlbum(i);if(0!=s){var a=t.grep(this.tracks,function(t){return t.album_id==s.id});return a.length>0&&(s.tracks=[],t.each(a,function(t,i){s.tracks.push(a[t].id)})),s}return!1},getTrackInfo:function(t){var i=this.isTrack(t);if(0!=i){var s=this.getAlbumInfo(i.album_id);return 0!=s&&(i.album=s),i}return!1},play:function(i){if("current"!=i){this.isGUIVisible||"api"==this.settings.mode||l.apply(this);var s=this.getTrackInfo(i);if(0!=s)this.currentSoundtrack=s.id,this.audio.src!=s.mp3&&(this.audio.src=s.mp3),this.audio.play(),t("."+this.settings.classPrefix+"-gui").find('[data-action="play"]').html(this.settings.pauseBt),h.apply(this,[s]),this.debug("Play: "+s.title);else{var a=this.getAlbumInfo(i);0!=a?this.play(a.tracks[0]):this.play("current")}}else this.audio.paused?"undefined"!=typeof this.audio.src&&this.audio.src.length>3?(this.audio.play(),t("."+this.settings.classPrefix+"-gui").find('[data-action="play"]').html(this.settings.pauseBt)):this.play(this.getCurrentSoundtrackId()):this.pause()},pause:function(){this.audio.pause(),t("."+this.settings.classPrefix+"-gui").find('[data-action="play"]').html(this.settings.playBt),this.debug("Paused")},stop:function(){this.pause(),this.audio.currentTime=0,this.debug("Stopped")},next:function(){var t=this.getTrackInfo(this.getCurrentSoundtrackId()),i=this.tracks.indexOf(t);i>=0&&i<this.tracks.length-1?this.play(this.tracks[i+1].id):this.play(this.tracks[0].id)},prev:function(){var t=this.getTrackInfo(this.getCurrentSoundtrackId()),i=this.tracks.indexOf(t);i>0&&i<=this.tracks.length-1?this.play(this.tracks[i-1].id):this.play(this.tracks[this.tracks.length-1].id)}}),t.fn[p]=function(i){var s=arguments;if(i===a||"object"==typeof i)return this.each(function(){t.data(this,"plugin_"+p)||t.data(this,"plugin_"+p,new o(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var n;return this.each(function(){var a=t.data(this,"plugin_"+p);a instanceof o&&"function"==typeof a[i]&&(n=a[i].apply(a,Array.prototype.slice.call(s,1))),"destroy"===i&&t.data(this,"plugin_"+p,null)}),n!==a?n:this}}}(jQuery,window,document);