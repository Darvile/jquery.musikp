!function(t,i,s,n){"use strict";function a(){this.$elem.find("[data-musikp]").on("click",function(i){i.preventDefault(),this.play(t(i.target).data("musikp"))}.bind(this))}function e(){t("."+this.settings.classPrefix+"-gui").find('[data-action="play"]').on("click",function(t){t.preventDefault(),this.play("current")}.bind(this)),t("."+this.settings.classPrefix+"-gui").find('[data-action="next"]').on("click",function(t){t.preventDefault(),this.next()}.bind(this)),t("."+this.settings.classPrefix+"-gui").find('[data-action="prev"]').on("click",function(t){t.preventDefault(),this.prev()}.bind(this)),t("."+this.settings.classPrefix+"-gui").find('[data-action="expand"]').on("click",function(t){t.preventDefault(),this.toggleExpandedGUI()}.bind(this)),this.audio.addEventListener("loadeddata",function(){t("."+this.settings.classPrefix+"-gui").find('[data-live="duration"]').html(h.apply(this,[this.audio.duration]))}.bind(this)),this.audio.addEventListener("timeupdate",function(){t("."+this.settings.classPrefix+"-gui").find('[data-live="timer"]').html(h.apply(this,[this.audio.currentTime]))}.bind(this))}function r(){var t=function(t,i){return t==i?0:t<i?-1:1},i=function(i,s){var n=t;return i&&(n=function(s,n){return t(i(s),i(n))}),s?function(t,i){return-1*n(t,i)}:n},s=function(){for(var s,n,a,e=[],r=arguments.length,u=0;u<r;u++)s=arguments[u],"string"==typeof s?(n=s,a=t):(n=s.name,a=i(s.primer,s.reverse)),e.push({name:n,cmp:a});return function(t,i){for(var n,a,u,l=0,c=r;l<c&&(u=0,s=e[l],n=s.name,a=s.cmp,u=a(t[n],i[n]),0===u);l++);return u}};this.tracks=this.tracks.sort(s("album_id",{name:"track_number",primer:parseInt,reverse:!1}))}function u(){this.albums="undefined"!=typeof this.settings.playlist.albums?this.settings.playlist.albums:[],this.tracks="undefined"!=typeof this.settings.playlist.tracks?this.settings.playlist.tracks:[],r.apply(this),this.currentSoundtrack=this.tracks[0].id,this.debug("Playlist: "+this.albums.length+" albums, "+this.tracks.length+" soundtracks")}function l(){function i(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function s(t,s,n){return t.replace(new RegExp(i(s),"g"),n)}var n='<div class="$class-player"><div class="$class-wrapper"><div class="$class-button">$prev</div><div class="$class-button $class-button-xl">$play</div><div class="$class-button">$next</div><div class="$class-timer"><span data-live="artist">Unknown</span> - <span data-live="title">Unknown</span> &nbsp; | &nbsp; <span data-live="timer">00:00</span> / <span data-live="duration">00:00</span></div></div></div>',a=n;null!=this.settings.tpl&&this.settings.tpl.length>3&&(a=this.settings.tpl),a+='<div class="$class-tracklist">',a+="Other tracks:",a+="<ul>";for(var r=0;r<this.tracks.length;++r)if("undefined"==typeof this.tracks[r].album_id){var u=this.getTrackInfo(this.tracks[r].id);a+="<li>"+u.track_number+'. <a data-musikp="'+u.id+'" href="#">'+u.title+"</a></li>"}a+="</ul>";for(var r=0;r<this.albums.length;++r){var l=this.getAlbumInfo(this.albums[r].id);a+='<a data-musikp="'+l.id+'" href="#">'+l.artist+" - "+l.title+"</a>",a+='<a data-musikp="'+l.id+'" href="#"><div class="$class-cover" style="background-image:url(\''+l.cover+"');\"></div>"+l.artist+" - "+l.title+"</a>",a+="<ul>";for(var c=0;c<l.tracks.length;++c){var u=this.getTrackInfo(l.tracks[c]);a+="<li>"+u.track_number+'. <a data-musikp="'+u.id+'" href="#">'+u.title+"</a></li>"}a+="</ul>"}a+="</div>",a=s(a,"$class",this.settings.classPrefix),a=s(a,"$prev",'<span data-action="prev">'+this.settings.prevBt+"</span>"),a=s(a,"$next",'<span data-action="next">'+this.settings.nextBt+"</span>"),a=s(a,"$play",'<span data-action="play">'+this.settings.playBt+"</span>"),a=s(a,"$expand",'<span data-action="expand">'+this.settings.expandBt+"</span>"),t("body").append('<div class="'+this.settings.classPrefix+'-gui">'+a+"</div>"),setTimeout(function(){t("body").find("."+this.settings.classPrefix+"-gui").addClass(""+this.settings.classPrefix+"-loaded")}.bind(this),1e3),this.debug("GUI opened"),this.isGUIVisible=!0,e.apply(this)}function c(){this.audio=s.createElement("audio")}function h(t){var i=Math.floor(t),s=Math.floor(i/60);return s=s>=10?s:"0"+s,i=Math.floor(i%60),i=i>=10?i:"0"+i,s+":"+i}function d(i){t("."+this.settings.classPrefix+"-gui").find("[data-live]").each(function(s,n){var a=t(n),e=a.data("live");"duration"!=e&&"timer"!=e&&a.html(i[e])}.bind(this))}function o(i,s){this.element=i,this.$elem=t(this.element),this.settings=t.extend({},f,s),this._defaults=f,this._name=p,this.init()}var p="musikp",f={mode:"auto",classPrefix:"musikp",tpl:null,playBt:">",pauseBt:"||",stopBt:"X",nextBt:">>",prevBt:"<<",expandBt:"^",debug:!1,autoPlay:!1,onPause:function(){},onPlay:function(){}};t.extend(o.prototype,{init:function(){this.isGUIVisible=!1,u.apply(this),c.apply(this),"gui"===this.settings.mode&&l.apply(this),a.apply(this),this.settings.autoPlay===!0&&this.play()},debug:function(t){this.settings.debug===!0&&console.log("--- "+t+" ---")},isTrack:function(i){var s=t.grep(this.tracks,function(t){return t.id==i});return s.length>0&&s[0]},isAlbum:function(i){var s=t.grep(this.albums,function(t){return t.id==i});return s.length>0&&s[0]},getCurrentSoundtrackId:function(){return this.currentSoundtrack},toggleExpandedGUI:function(){t("."+this.settings.classPrefix+"-gui").toggleClass("expanded")},getAlbumInfo:function(i){var s=this.isAlbum(i);if(0!=s){var n=t.grep(this.tracks,function(t){return t.album_id==s.id});return n.length>0&&(s.tracks=[],t.each(n,function(t,i){s.tracks.push(n[t].id)})),s}return!1},getTrackInfo:function(t){var i=this.isTrack(t);if(0!=i){var s=this.getAlbumInfo(i.album_id);return 0!=s&&(i.album=s),i}return!1},play:function(i){if("current"!=i){this.isGUIVisible||"api"==this.settings.mode||l.apply(this);var s=this.getTrackInfo(i);if(0!=s)this.currentSoundtrack=s.id,this.audio.src!=s.mp3&&(this.audio.src=s.mp3),this.audio.play(),t("."+this.settings.classPrefix+"-gui").find('[data-action="play"]').html(this.settings.pauseBt),d.apply(this,[s]),this.debug("Play: "+s.title),this.settings.onPlay(this.getCurrentSoundtrackId());else{var n=this.getAlbumInfo(i);0!=n?this.play(n.tracks[0]):this.play("current"),this.settings.onPlay(this.getCurrentSoundtrackId())}}else this.audio.paused?"undefined"!=typeof this.audio.src&&this.audio.src.length>3?(this.audio.play(),t("."+this.settings.classPrefix+"-gui").find('[data-action="play"]').html(this.settings.pauseBt),this.settings.onPlay(this.getCurrentSoundtrackId())):this.play(this.getCurrentSoundtrackId()):this.pause()},pause:function(){this.audio.pause();var i=this.getCurrentSoundtrackId();t("."+this.settings.classPrefix+"-gui").find('[data-action="play"]').html(this.settings.playBt),this.debug("Paused"),this.settings.onPause(i)},stop:function(){this.pause(),this.audio.currentTime=0,this.debug("Stopped")},next:function(){var t=this.getTrackInfo(this.getCurrentSoundtrackId()),i=this.tracks.indexOf(t);i>=0&&i<this.tracks.length-1?this.play(this.tracks[i+1].id):this.play(this.tracks[0].id)},prev:function(){var t=this.getTrackInfo(this.getCurrentSoundtrackId()),i=this.tracks.indexOf(t);i>0&&i<=this.tracks.length-1?this.play(this.tracks[i-1].id):this.play(this.tracks[this.tracks.length-1].id)}}),t.fn[p]=function(i){var s=arguments;if(i===n||"object"==typeof i)return this.each(function(){t.data(this,"plugin_"+p)||t.data(this,"plugin_"+p,new o(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var a;return this.each(function(){var n=t.data(this,"plugin_"+p);n instanceof o&&"function"==typeof n[i]&&(a=n[i].apply(n,Array.prototype.slice.call(s,1))),"destroy"===i&&t.data(this,"plugin_"+p,null)}),a!==n?a:this}}}(jQuery,window,document);